<!DOCTYPE html>
<html>
<head>
  <title>Kirana Delivery Dashboard</title>
  <meta charset="utf-8" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.css" />
  <style>
    body { font-family: Arial, sans-serif; margin:0; padding:0; background-color:#fff2e3; }
    .container { display:flex; height:100vh; }
    .left-panel { flex:1; padding:20px; overflow-y:auto; background:white; box-shadow: 2px 0 8px rgba(0,0,0,0.1);}
    .right-panel { flex:1.2; position:relative; }
    h2,h3 { color:#66104d; margin-top:0; }
    label { display:block; margin-top:10px; font-weight:bold; }
    input, select, button { margin-top:5px; padding:8px; width:100%; border:1px solid #ccc; border-radius:6px; }
    button { background:#66104d; color:white; cursor:pointer; font-weight:bold; transition:0.3s; }
    button:hover { background:#8a1d66; }
    .parcel-list { display:flex; flex-direction:column; gap:12px; max-height:450px; overflow-y:auto; margin-top:10px; padding-right:5px; }
    .parcel-card { background:#fff2e3; border-left:6px solid #66104d; border-radius:8px; padding:12px; box-shadow:0 2px 6px rgba(0,0,0,0.1); cursor:pointer; }
    .parcel-card strong { color:#66104d; }
    .parcel-card.selected { background:#ffe0f0; border-left:6px solid #ff3399; }
    .parcel-card.return { background:#e3f2ff; border-left:6px solid #3399ff; }
    .parcel-card.return.selected { background:#cce5ff; border-left:6px solid #0056b3; }
    .totals { margin-top:20px; padding:12px; border-radius:8px; background:#fff2e3; }
    .totals p { margin:5px 0; font-weight:bold; color:#66104d; }
    #map { height:100%; width:100%; border-left:1px solid #ccc; }
    .add-parcel { margin-top:20px; padding:12px; background:#fff2e3; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.1); }
    .stats { display:flex; gap:15px; margin:10px 0; }
    .stat-box { padding:8px 14px; border-radius:6px; color:white; font-weight:bold; }
    .stat-delivery { background:#66104d; }
    .stat-return { background:#3399ff; }
    .info-boxes { display:flex; gap:15px; margin:10px 0; }
    .info { flex:1; padding:8px 14px; border-radius:6px; background:#ffe6f0; color:#66104d; font-weight:bold; text-align:center; }
    .backend-box { margin-top:20px; padding:12px; border-radius:8px; background:#66104d; color:white; font-weight:bold; text-align:center; font-size:16px; box-shadow:0 2px 6px rgba(0,0,0,0.2); }
    .call-btn { margin-top:8px; padding:6px 10px; background:#66104d; color:white; border:none; border-radius:5px; cursor:pointer; font-size:14px; }
    .call-btn:hover { background:#218838; }
    /* Kirana Scorecard */
    .scorecard { margin:10px 0; padding:10px; border-radius:8px; background:#ffe6f0; color:#66104d; font-weight:bold; text-align:center; border:2px solid #66104d; }
    /* Bonus Box */
    .bonus-box { margin:10px 0; padding:10px; border-radius:8px; background:#e3ffe6; color:#006622; font-weight:bold; text-align:center; border:2px solid #00aa44; }
  </style>
</head>
<body>

<div class="container">
  <div class="left-panel">
    <h2>Kirana A Dashboard (Dense Urban Region)</h2>
    <div class="info-boxes">
      <div class="info">COD Collected : ₹ <span id="cash">5253</span></div>
      <div class="info">LMD helper will come in <span id="days">1 day</span></div>
    </div>

    <div class="info-boxes">
      <div class="info">This Week Payout : ₹ <span id="weekPayout">1425</span></div>
      <div class="info">To be credited in <span id="creditDays">3 days</span></div>
    </div>

    <!-- Kirana Scorecard Rating -->
    <div class="scorecard">Kirana Scorecard Rating: <span id="scoreRating">87/100</span></div>

    <!-- Bonus Box -->
    <div class="bonus-box">Complete <span id="remainingDeliveries">50</span> more deliveries to get the ₹<span id="bonusAmount">500</span> bonus</div>

    <h3>To be Delivered</h3>
    <div class="stats">
      <div class="stat-box stat-delivery">Deliveries: <span id="deliveryCount">0</span></div>
      <div class="stat-box stat-return">Returns: <span id="returnCount">0</span></div>
    </div>

    <div class="parcel-list" id="parcelList"></div>

    <div class="totals">
      <h3>Total Day's Payout</h3>
      <p>Total if ≤2 Hrs: <span id="p2h">0</span> Rs</p>
      <p>Total if ≤24 Hrs: <span id="p24h">0</span> Rs</p>
      <p>Total if ≤48 Hrs: <span id="p48h">0</span> Rs</p>
      <p>Total if ≥48 Hrs: <span id="p48p">0</span> Rs</p>
    </div>

    <div class="backend-box">Backend</div>

    <div class="add-parcel">
      <h3>Add New Parcel</h3>
      <label>User Name:</label>
      <input type="text" id="newUser" placeholder="Enter user name">
      <label>Address:</label>
      <input type="text" id="newAddress" placeholder="Enter address">
      <label>Latitude:</label>
      <input type="number" id="newLat" placeholder="Enter latitude" step="0.0001">
      <label>Longitude:</label>
      <input type="number" id="newLng" placeholder="Enter longitude" step="0.0001">
      <label>Distance (m):</label>
      <input type="number" id="newDistance" placeholder="Distance in meters">
      <label>Volume (cm):</label>
      <input type="text" id="newVolume" placeholder="L*W*H, e.g., 45*25*5">
      <label>Weight (kg):</label>
      <input type="number" id="newWeight" placeholder="Weight in kg">
      <button onclick="addParcel()">Add Parcel</button>
    </div>
  </div>

  <div class="right-panel">
    <div id="map"></div>
  </div>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.js"></script>
<script>
const kiranaLat = 29.864;
const kiranaLng = 77.888;

function parseVolume(volStr){ return volStr.split("*").map(Number); }

const names = ["Aarav","Isha","Rohan","Priya","Kabir","Ananya","Aditya","Sanya"];
const streets = ["MG Road","Park Street","Linking Road","Church Street","Brigade Road"];
function randomVolume(){ return `${Math.floor(Math.random()*51)+10}*${Math.floor(Math.random()*51)+5}*${Math.floor(Math.random()*31)+5}`; }

let parcels=[];
for(let i=0;i<24;i++){
  parcels.push({
    id:"P"+(1000+i),
    user:names[Math.floor(Math.random()*names.length)],
    address:Math.floor(Math.random()*200+1)+" "+streets[Math.floor(Math.random()*streets.length)],
    distance:Math.floor(Math.random()*401),
    volume:randomVolume(),
    weight:parseFloat((Math.random()*10+1).toFixed(1)),
    lat:kiranaLat + (Math.random()-0.5)/500,
    lng:kiranaLng + (Math.random()-0.5)/500,
    selected:false,
    type:"delivery"
  });
}
for(let i=0;i<4;i++){
  parcels.push({
    id:"R"+(2000+i),
    user:names[Math.floor(Math.random()*names.length)],
    address:Math.floor(Math.random()*200+1)+" "+streets[Math.floor(Math.random()*streets.length)],
    distance:Math.floor(Math.random()*401),
    volume:randomVolume(),
    weight:parseFloat((Math.random()*10+1).toFixed(1)),
    lat:kiranaLat + (Math.random()-0.5)/500,
    lng:kiranaLng + (Math.random()-0.5)/500,
    selected:false,
    type:"return"
  });
}

let map=L.map('map').setView([kiranaLat,kiranaLng],16);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19}).addTo(map);
let routeControl=null;

function renderParcels(){
  const list=document.getElementById("parcelList");
  list.innerHTML="";
  let p2h=0,p24h=0,p48h=0,p48p=0;
  let deliveryCount=0, returnCount=0;

  parcels.forEach((p,index)=>{
    if(p.type==="delivery") deliveryCount++; else returnCount++;

    const dims=parseVolume(p.volume);
    const D = p.distance>200?1:0;
    const V = dims.some(d=>d>45)?1:0;
    const W = p.weight>5?1:0;

    let payout;
    if(p.type==="return"){ payout=10; }
    else{ payout=13+D*2+V*(W+1)*2; }

    p2h += payout;
    p24h += (p.type==="return"?10:10+D*2+V*(W+1)*2);
    p48h += (p.type==="return"?10:9+D*2+V*(W+1)*2);
    p48p += (p.type==="return"?10:5+D*2+V*(W+1)*2);

    const card=document.createElement("div");
    card.className="parcel-card "+(p.type==="return"?"return":"")+(p.selected?" selected":"");
    card.innerHTML=`<strong>${p.id}</strong> - ${p.user}<br>
      Address: ${p.address}<br>
      Lat: ${p.lat.toFixed(5)}, Lng: ${p.lng.toFixed(5)}<br>
      Distance: ${p.distance} m<br>
      Volume: ${p.volume} cm<br>
      Weight: ${p.weight} kg<br>
      <button class="call-btn">Click to Call</button>`;
    card.addEventListener('click', function(e){
      if(e.target.classList.contains("call-btn")) return;
      p.selected=!p.selected;
      renderParcels();
    });
    list.appendChild(card);
  });

  document.getElementById("p2h").innerText=p2h;
  document.getElementById("p24h").innerText=p24h;
  document.getElementById("p48h").innerText=p48h;
  document.getElementById("p48p").innerText=p48p;
  document.getElementById("deliveryCount").innerText=deliveryCount;
  document.getElementById("returnCount").innerText=returnCount;

  updateMap();
}

function addParcel(){
  const user=document.getElementById("newUser").value||"Anonymous";
  const address=document.getElementById("newAddress").value||"Unknown Street";
  const distance=parseInt(document.getElementById("newDistance").value);
  const volume=document.getElementById("newVolume").value;
  const weight=parseFloat(document.getElementById("newWeight").value);
  const lat=parseFloat(document.getElementById("newLat").value);
  const lng=parseFloat(document.getElementById("newLng").value);

  parcels.push({id:"P"+(1000+parcels.length),user,address,distance,volume,weight,lat,lng,selected:false,type:"delivery"});
  renderParcels();
}

function updateMap(){
  if(routeControl){ map.removeControl(routeControl); routeControl=null; }

  const selected=parcels.filter(p=>p.selected);
  if(selected.length===0) return;

  const waypoints=[L.latLng(kiranaLat,kiranaLng),...selected.map(p=>L.latLng(p.lat,p.lng))];

  routeControl=L.Routing.control({
    waypoints: waypoints,
    router: L.Routing.osrmv1({
      serviceUrl: "https://router.project-osrm.org/route/v1",
      profile: "foot",
      routingOptions: { alternatives: false, overview: "full", steps: true }
    }),
    lineOptions: { styles: [{color:'purple',weight:4}] },
    createMarker: function(i, wp, n){
      if(i===0){
        return L.marker(wp.latLng,{icon:L.divIcon({
          className:"custom-div-icon",
          html:`<div style="background:#ff3333;color:white;border-radius:50%;width:26px;height:26px;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:bold;">K</div>`,
          iconSize:[26,26]
        })}).bindPopup("Kirana Start");
      }
      const parcel=selected[i-1];
      const markerColor=parcel.type==="return"?"#3399ff":"#66104d";
      return L.marker(wp.latLng,{icon:L.divIcon({
        className:"custom-div-icon",
        html:`<div style="background:${markerColor};color:white;border-radius:50%;width:26px;height:26px;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:bold;">${i}</div>`,
        iconSize:[26,26]
      })}).bindPopup(`${parcel.type==="return"?"Return":"Delivery"} - ${parcel.id}`);
    },
    addWaypoints: false,
    draggableWaypoints: false,
    fitSelectedRoutes: true,
    show: true
  }).addTo(map);
}

renderParcels();
</script>
</body>
</html>








