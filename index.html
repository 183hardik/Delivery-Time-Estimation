<!DOCTYPE html>
<html>
<head>
  <title>Kirana Delivery Dashboard</title>
  <meta charset="utf-8" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin:0; padding:0; background-color:#fff2e3; }
    .container { display:flex; height:100vh; }
    .left-panel { flex:1; padding:20px; overflow-y:auto; background:#fef6f0; box-shadow: 2px 0 12px rgba(0,0,0,0.15); border-right:1px solid #ddd;}
    .right-panel { flex:1.2; position:relative; }
    h2,h3 { color:#66104d; margin-top:0; }
    label { display:block; margin-top:10px; font-weight:bold; }
    input, select, button { margin-top:5px; padding:8px; width:100%; border:1px solid #ccc; border-radius:6px; font-size:14px; }
    button { background:#66104d; color:white; cursor:pointer; font-weight:bold; transition:0.3s; }
    button:hover { background:#8a1d66; }
    .parcel-list { 
      display:flex; 
      flex-direction:column; 
      gap:14px; 
      max-height:450px; 
      overflow-y:auto; 
      margin-top:10px; 
      padding-right:5px; 
    }
    .parcel-card-container { display:flex; flex-direction:column; }
    .select-text { font-size:12px; color:#66104d; margin-bottom:4px; }
    .parcel-card { 
      background:#fff2e3; 
      border-left:6px solid #66104d; 
      border-radius:10px; 
      padding:14px; 
      box-shadow:0 3px 8px rgba(0,0,0,0.1); 
      cursor:pointer;
      transition:0.2s all;
    }
    .parcel-card:hover { background:#ffe5d0; transform: translateY(-2px); }
    .parcel-card.selected { background:#ffd2b8; border-left:6px solid #8a1d66; box-shadow:0 4px 12px rgba(0,0,0,0.15); }
    .parcel-card strong { color:#66104d; }
    .totals { margin-top:20px; padding:14px; border-radius:10px; background:#fff2e3; box-shadow:0 3px 8px rgba(0,0,0,0.05);}
    .totals p { margin:6px 0; font-weight:bold; color:#66104d; }
    #map { height:100%; width:100%; border-left:1px solid #ccc; }
    .add-parcel { margin-top:20px; padding:14px; background:#fff2e3; border-radius:10px; box-shadow:0 3px 8px rgba(0,0,0,0.05); }
  </style>
</head>
<body>

<div class="container">
  <div class="left-panel">
    <h2>Kirana A Dashboard</h2>
    <div class="parcel-list" id="parcelList"></div>

    <div class="totals">
      <h3>Total Day's Payout</h3>
      <p>Total if ≤2 Hrs: <span id="p2h">0</span> Rs</p>
      <p>Total if ≤24 Hrs: <span id="p24h">0</span> Rs</p>
      <p>Total if ≤48 Hrs: <span id="p48h">0</span> Rs</p>
      <p>Total if ≥48 Hrs: <span id="p48p">0</span> Rs</p>
    </div>

    <div class="add-parcel">
      <h3>Add New Parcel</h3>
      <label>User Name:</label>
      <input type="text" id="newUser" placeholder="Enter user name">

      <label>Address:</label>
      <input type="text" id="newAddress" placeholder="Enter address">

      <label>Latitude:</label>
      <input type="number" id="newLat" placeholder="Enter latitude" step="0.0001">

      <label>Longitude:</label>
      <input type="number" id="newLng" placeholder="Enter longitude" step="0.0001">

      <label>Distance (m):</label>
      <input type="number" id="newDistance" placeholder="Distance in meters">

      <label>Volume (cm):</label>
      <input type="text" id="newVolume" placeholder="L*W*H, e.g., 45*25*5">

      <label>Weight (kg):</label>
      <input type="number" id="newWeight" placeholder="Weight in kg">

      <button onclick="addParcel()">Add Parcel</button>
    </div>
  </div>

  <div class="right-panel">
    <div id="map"></div>
  </div>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
const kiranaLat = 29.864;
const kiranaLng = 77.888;

function parseVolume(volStr){ return volStr.split("*").map(Number); }

const names = ["Aarav","Isha","Rohan","Priya","Kabir","Ananya","Aditya","Sanya"];
const streets = ["MG Road","Park Street","Linking Road","Church Street","Brigade Road"];
function randomVolume(){ return `${Math.floor(Math.random()*51)+10}*${Math.floor(Math.random()*51)+5}*${Math.floor(Math.random()*31)+5}`; }

const deliveryPoints = [
  {lat:29.8710, lng:77.8942},
  {lat:29.8725, lng:77.8918},
  {lat:29.8708, lng:77.8965},
  {lat:29.8732, lng:77.8981},
  {lat:29.8699, lng:77.8927},
  {lat:29.8687, lng:77.8954},
  {lat:29.8740, lng:77.8995},
  {lat:29.8669, lng:77.8902},
  {lat:29.8678, lng:77.8939},
  {lat:29.8751, lng:77.8968},
  {lat:29.8719, lng:77.8972},
  {lat:29.8681, lng:77.8912},
  {lat:29.8722, lng:77.8930},
  {lat:29.8738, lng:77.8959},
  {lat:29.8695, lng:77.8977},
  {lat:29.8702, lng:77.8991},
  {lat:29.8745, lng:77.8925},
  {lat:29.8673, lng:77.8948},
  {lat:29.8716, lng:77.8905},
  {lat:29.8690, lng:77.8983}
];

let parcels=[];
for(let i=0;i<deliveryPoints.length;i++){
  parcels.push({
    id:"P"+(1000+i),
    user:names[Math.floor(Math.random()*names.length)],
    address:Math.floor(Math.random()*200+1)+" "+streets[Math.floor(Math.random()*streets.length)],
    distance:Math.floor(Math.random()*401),
    volume:randomVolume(),
    weight:parseFloat((Math.random()*10+1).toFixed(1)),
    lat:deliveryPoints[i].lat,
    lng:deliveryPoints[i].lng,
    selected:false
  });
}

let map=L.map('map').setView([kiranaLat,kiranaLng],15);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19}).addTo(map);
let markers=[];
let routeLine=null;

function renderParcels(){
  const list=document.getElementById("parcelList");
  list.innerHTML="";
  let p2h=0,p24h=0,p48h=0,p48p=0;

  parcels.forEach((p,index)=>{
    const dims=parseVolume(p.volume);
    const D = p.distance>200?1:0;
    const V = dims.some(d=>d>45)?1:0;
    const W = p.weight>5?1:0;

    p2h += 13+D*2+V*(W+1)*2;
    p24h += 10+D*2+V*(W+1)*2;
    p48h += 9+D*2+V*(W+1)*2;
    p48p += 5+D*2+V*(W+1)*2;

    const container = document.createElement("div");
    container.className = "parcel-card-container";

    const selectText = document.createElement("div");
    selectText.className = "select-text";
    selectText.innerText = "Click to select";

    const card = document.createElement("div");
    card.className = "parcel-card"+(p.selected?" selected":"");
    card.innerHTML=`
      <strong>${p.id}</strong> - ${p.user}<br>
      Address: ${p.address}<br>
      Lat: ${p.lat.toFixed(5)}, Lng: ${p.lng.toFixed(5)}<br>
      Distance: ${p.distance} m<br>
      Volume: ${p.volume} cm<br>
      Weight: ${p.weight} kg
    `;
    card.addEventListener('click', function(){
      p.selected = !p.selected;
      card.classList.toggle('selected');
      updateMap();
    });

    container.appendChild(selectText);
    container.appendChild(card);
    list.appendChild(container);
  });

  document.getElementById("p2h").innerText=p2h;
  document.getElementById("p24h").innerText=p24h;
  document.getElementById("p48h").innerText=p48h;
  document.getElementById("p48p").innerText=p48p;

  updateMap();
}

function addParcel(){
  const user=document.getElementById("newUser").value||"Anonymous";
  const address=document.getElementById("newAddress").value||"Unknown Street";
  const distance=parseInt(document.getElementById("newDistance").value);
  const volume=document.getElementById("newVolume").value;
  const weight=parseFloat(document.getElementById("newWeight").value);
  const lat=parseFloat(document.getElementById("newLat").value);
  const lng=parseFloat(document.getElementById("newLng").value);

  parcels.push({id:"P"+(1000+parcels.length),user,address,distance,volume,weight,lat,lng,selected:false});
  renderParcels();
}

// Nearest neighbor route with numbered markers
function updateMap(){
  if(routeLine){ map.removeLayer(routeLine); routeLine=null; }
  markers.forEach(m=>map.removeLayer(m));
  markers=[];

  const selected = parcels.filter(p=>p.selected);
  if(selected.length===0) return;

  const remaining = [...selected];
  const path=[];
  let current={lat:kiranaLat,lng:kiranaLng};
  while(remaining.length>0){
    remaining.sort((a,b)=>{
      const da=Math.hypot(a.lat-current.lat,a.lng-current.lng);
      const db=Math.hypot(b.lat-current.lat,b.lng-current.lng);
      return da-db;
    });
    const next=remaining.shift();
    path.push(next);
    current=next;
  }

  const latlngs=[[kiranaLat,kiranaLng],...path.map(p=>[p.lat,p.lng])];
  routeLine=L.polyline(latlngs,{color:'purple'}).addTo(map);
  map.fitBounds(routeLine.getBounds().pad(0.2));

  latlngs.forEach((pos,i)=>{
    let popupText;
    if(i===0){ 
      popupText="Kirana Start"; 
      const m=L.marker(pos,{icon:L.divIcon({
        className:"custom-div-icon",
        html:`<div style="background:#ff3333;color:white;border-radius:50%;width:24px;height:24px;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:bold;">K</div>`,
        iconSize:[24,24]
      })}).addTo(map).bindPopup(popupText);
      markers.push(m);
    }
    else{
      const p=path[i-1];
      const dims=parseVolume(p.volume);
      const D=p.distance>200?1:0;
      const V=dims.some(d=>d>45)?1:0;
      const W=p.weight>5?1:0;
      const payout=13+D*2+V*(W+1)*2;
      popupText=`Step ${i}: ${p.id} - ${p.user}<br>Distance:${p.distance}m<br>Volume:${p.volume}cm<br>Weight:${p.weight}kg<br>Payout: ${payout} Rs`;

      const m=L.marker(pos,{icon:L.divIcon({
        className:"custom-div-icon",
        html:`<div style="background:#66104d;color:white;border-radius:50%;width:24px;height:24px;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:bold;">${i}</div>`,
        iconSize:[24,24]
      })}).addTo(map).bindPopup(popupText);
      markers.push(m);
    }
  });
}

renderParcels();
</script>

</body>
</html>




